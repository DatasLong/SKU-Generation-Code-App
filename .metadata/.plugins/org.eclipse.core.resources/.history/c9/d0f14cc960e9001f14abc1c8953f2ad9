import javax.swing.*;
import javax.swing.table.DefaultTableModel;
import java.awt.*;
import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;
import java.io.BufferedWriter;
import java.io.FileWriter;
import java.io.IOException;
import java.util.HashSet;
import java.util.Random;
import java.util.Set;

public class UniqueStringGeneratorGUI extends JFrame {
    private static final int STRING_LENGTH = 8;
    private static final String CHAR_POOL = "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";
    private static final char[] REQUIRED_CHARS = {'0', 'O', 'I', '1', 'S', '5'};
    private static final Random random = new Random();

    private JTextField quantityField, blendingCountryField, yyField, targetCountryField, mmField, ddField;
    private JTable resultTable;
    private DefaultTableModel tableModel;

    public UniqueStringGeneratorGUI() {
        setTitle("SKU Generation Application");
        setSize(700, 500);
        setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
        getContentPane().setLayout(null);  // Using absolute positioning

        // Quantity label and field
        JLabel quantityLabel = new JLabel("Enter Quantity:");
        quantityLabel.setBounds(40, 20, 290, 30);
        getContentPane().add(quantityLabel);
        quantityField = new JTextField();
        quantityField.setBounds(360, 20, 255, 30);
        getContentPane().add(quantityField);

        // Blending Country label and field
        JLabel blendingCountryLabel = new JLabel("Enter Blending Country (1-9 characters, uppercase only):");
        blendingCountryLabel.setBounds(40, 61, 290, 30);
        getContentPane().add(blendingCountryLabel);
        blendingCountryField = new JTextField();
        blendingCountryField.setBounds(360, 61, 255, 30);
        getContentPane().add(blendingCountryField);

        // YY label and field
        JLabel yyLabel = new JLabel("Enter YY (25 to 99):");
        yyLabel.setBounds(40, 100, 290, 30);
        getContentPane().add(yyLabel);
        yyField = new JTextField();
        yyField.setBounds(360, 100, 255, 30);
        getContentPane().add(yyField);

        // Target Country label and field
        JLabel targetCountryLabel = new JLabel("Enter Target Country (1-99):");
        targetCountryLabel.setBounds(40, 141, 290, 30);
        getContentPane().add(targetCountryLabel);
        targetCountryField = new JTextField();
        targetCountryField.setBounds(360, 141, 255, 30);
        getContentPane().add(targetCountryField);

        // MM label and field
        JLabel mmLabel = new JLabel("Enter MM (1-12):");
        mmLabel.setBounds(40, 182, 290, 30);
        getContentPane().add(mmLabel);
        mmField = new JTextField();
        mmField.setBounds(360, 182, 255, 30);
        getContentPane().add(mmField);

        // DD label and field
        JLabel ddLabel = new JLabel("Enter DD (1-30):");
        ddLabel.setBounds(40, 223, 290, 30);
        getContentPane().add(ddLabel);
        ddField = new JTextField();
        ddField.setBounds(360, 223, 255, 30);
        getContentPane().add(ddField);

        // Result table setup
        tableModel = new DefaultTableModel(new Object[]{"No", "Code"}, 0);
        resultTable = new JTable(tableModel);
        JScrollPane scrollPane = new JScrollPane(resultTable);
        scrollPane.setBounds(20, 260, 640, 150);
        getContentPane().add(scrollPane);

        // Generate button
        JButton generateButton = new JButton("Generate SKU Codes");
        generateButton.setBounds(20, 430, 200, 30);
        generateButton.addActionListener(new ActionListener() {
            @Override
            public void actionPerformed(ActionEvent e) {
                generateSKUCodes();
            }
        });
        getContentPane().add(generateButton);
    }

    private void generateSKUCodes() {
        int quantity;
        try {
            quantity = Integer.parseInt(quantityField.getText().trim());
            if (quantity <= 0) {
                JOptionPane.showMessageDialog(this, "Quantity must be a positive number.", "Error", JOptionPane.ERROR_MESSAGE);
                return;
            }
        } catch (NumberFormatException e) {
            JOptionPane.showMessageDialog(this, "Invalid quantity.", "Error", JOptionPane.ERROR_MESSAGE);
            return;
        }

        String blendingCountry = blendingCountryField.getText().trim();
        if (!blendingCountry.matches("^[A-Z]{1,9}$")) {
            JOptionPane.showMessageDialog(this, "Invalid BlendingCountry.", "Error", JOptionPane.ERROR_MESSAGE);
            return;
        }

        String yy = yyField.getText().trim();
        if (!yy.matches("^[2-9][5-9]$|^9[0-9]$")) {
            JOptionPane.showMessageDialog(this, "Invalid YY.", "Error", JOptionPane.ERROR_MESSAGE);
            return;
        }

        String targetCountry = targetCountryField.getText().trim();
        if (!targetCountry.matches("^[1-9]$|^[1-9][0-9]$")) {
            JOptionPane.showMessageDialog(this, "Invalid Target Country.", "Error", JOptionPane.ERROR_MESSAGE);
            return;
        }
        if (targetCountry.length() == 1) {
            targetCountry = "0" + targetCountry;
        }

        String mm = mmField.getText().trim();
        if (!mm.matches("^[1-9]$|^1[0-2]$")) {
            JOptionPane.showMessageDialog(this, "Invalid MM.", "Error", JOptionPane.ERROR_MESSAGE);
            return;
        }
        if (mm.length() == 1) {
            mm = "0" + mm;
        }

        String dd = ddField.getText().trim();
        if (!dd.matches("^[1-9]$|^[1-2][0-9]$|^30$")) {
            JOptionPane.showMessageDialog(this, "Invalid DD.", "Error", JOptionPane.ERROR_MESSAGE);
            return;
        }
        if (dd.length() == 1) {
            dd = "0" + dd;
        }

        Set<String> uniqueStrings = new HashSet<>();
        while (uniqueStrings.size() < quantity) {
            String randomString = generateRandomString();
            uniqueStrings.add(blendingCountry + yy + targetCountry + mm + randomString + dd);
        }

        // Clear previous data from table
        tableModel.setRowCount(0);

        // Add new data to table
        int index = 1;
        for (String str : uniqueStrings) {
            tableModel.addRow(new Object[]{index++, str});
        }

        // Save to file
        try (BufferedWriter writer = new BufferedWriter(new FileWriter("C:\\Users\\doant\\Downloads\\code_test_1.txt"))) {
            for (String str : uniqueStrings) {
                writer.write(str);
                writer.newLine();
            }
            JOptionPane.showMessageDialog(this, "Strings saved to file successfully.", "Success", JOptionPane.INFORMATION_MESSAGE);
        } catch (IOException ex) {
            JOptionPane.showMessageDialog(this, "Error saving to file: " + ex.getMessage(), "Error", JOptionPane.ERROR_MESSAGE);
        }
    }

    private static String generateRandomString() {
        StringBuilder sb = new StringBuilder();
        char requiredChar = REQUIRED_CHARS[random.nextInt(REQUIRED_CHARS.length)];
        sb.append(requiredChar);
        while (sb.length() < STRING_LENGTH) {
            char randomChar = CHAR_POOL.charAt(random.nextInt(CHAR_POOL.length()));
            sb.append(randomChar);
        }
        for (int i = STRING_LENGTH - 1; i > 0; i--) {
            int swapIndex = random.nextInt(i + 1);
            char temp = sb.charAt(i);
            sb.setCharAt(i, sb.charAt(swapIndex));
            sb.setCharAt(swapIndex, temp);
        }
        return sb.toString();
    }

    public static void main(String[] args) {
        SwingUtilities.invokeLater(() -> {
            UniqueStringGeneratorGUI gui = new UniqueStringGeneratorGUI();
            gui.setVisible(true);
        });
    }
}
